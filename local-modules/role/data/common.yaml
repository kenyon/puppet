---

role::puppetmaster::classes:
  - puppetdb
  - puppetdb::master::config
  - role::puppetmaster::hiera_eyaml

role::puppetmaster::gems:
  - hiera-eyaml
  - r10k

role::puppetmaster::logrotate_rules:
  webhook:
    path: /var/log/webhook/access.log
    missingok: true
    postrotate: systemctl restart webhook

role::puppetmaster::packages:
  - augeas-tools
  - ruby

# Ruby gems for the puppetserver embedded Ruby environment.
role::puppetmaster::puppetserver_gems:
  - r10k

# This webhook setup runs a web server on port 8088. Then I have
# configured a webhook in my puppet environments git repository for
# URL http://puppet.kenyonralph.com:8088/payload that runs on push events:
# https://gitlab.com/kenyon/puppet/hooks
# So when I push to gitlab, 'r10k deploy environment --verbose --puppetfile'
# gets run.
role::puppetmaster::r10k_deploy_settings:
  purge_levels:
    - deployment
    - environment
    - puppetfile
role::puppetmaster::r10k_webhook_enable_ssl: false
role::puppetmaster::r10k_webhook_group: root
role::puppetmaster::r10k_webhook_protected: false
role::puppetmaster::r10k_webhook_use_mcollective: false
role::puppetmaster::r10k_webhook_user: root
