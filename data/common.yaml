---
# Common data.

classes:
  - systemd::systemctl::daemon_reload
  - timezone
  - sudo
  - git
  - ssh
  - mysite::ntp
  - accounts

lookup_options:
  accounts::user_list:
    merge: deep
  accounts::group_list:
    merge: deep
  apt::sources:
    merge: hash
  rhsm::enabled_repo_ids:
    merge: unique

timezone::timezone: America/Los_Angeles

# NTP servers to use for hosts that are in the NTP Pool.
ntp_servers:
  - clock.fmt.he.net
  - ntp.caida.org
  - ntp.vt.edu

# Packages I want installed.
packages:
  - aspell
  - colordiff
  - curl
  - emacs-nox
  - etckeeper
  - htop
  - info
  - keychain
  - lsof
  - mlocate
  - multitail
  - mutt
  - ndisc6
  - nmap # nmap includes ncat, its version of netcat (nc)
  - psmisc
  - pwgen
  - rsync
  - subnetcalc
  - time
  - tmux
  - tree
  - unzip
  - w3m
  - wdiff
  - wget
  - whois
  - zsh

# Packages I want to be absent.
# Can't really remove multiple packages though, even if I have listed
# all of their dependencies, because it tries to remove each package
# individually:
# https://tickets.puppetlabs.com/browse/PUP-146
# https://tickets.puppetlabs.com/browse/PUP-1061
packages_absent:
  - nano
  - rsyslog

services:
  ctrl-alt-del.target:
    ensure: stopped
    enable: mask

accounts::user_list:
  kenyon:
    ignore_password_if_empty: true
    password: ''
    comment: Kenyon Ralph
    shell: /bin/zsh
    groups:
      - sudo
      - adm
    managevim: false
    sshkeys:
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKcX1L+30WOCRpdhUAUBB7MedN2hteApi8E7RUVOPxsO kenyon@einstein

sudo::configs:
  insults:
    content: Defaults insults
  kenyon:
    content: 'kenyon ALL = (ALL:ALL) NOPASSWD: ALL'
  lessenv:
    content: Defaults env_keep += "LESS_TERMCAP_us LESS_TERMCAP_ue LESS_TERMCAP_so LESS_TERMCAP_se LESS_TERMCAP_me LESS_TERMCAP_md LESS_TERMCAP_mb"
  lessenv2:
    content: Defaults env_keep += "PAGER LESS MANWIDTH LESSOPEN BLOCKSIZE"

git::configs:
  user.name:
    value: Kenyon Ralph
    user: kenyon
  user.email:
    value: kenyon@kenyonralph.com
    user: kenyon
  user.signingkey:
    value: '0x98FF3EF9C9B912D5'
    user: kenyon
  color.ui:
    value: always
    user: kenyon
  commit.verbose:
    value: 'true'
    user: kenyon
  commit.gpgsign:
    value: 'true'
    user: kenyon
  core.pager:
    value: less --quit-if-one-screen --LONG-PROMPT --ignore-case --RAW-CONTROL-CHARS --HILITE-UNREAD --no-init
    user: kenyon
  log.decorate:
    value: full
    user: kenyon

augeases:
  puppet.conf:
    context: /files/etc/puppetlabs/puppet/puppet.conf
    changes:
      - set main/show_diff true
      - set main/server puppet.kenyonralph.com
  system.conf:
    incl: /etc/systemd/system.conf
    lens: Puppet.lns
    changes:
      - set Manager/CtrlAltDelBurstAction none
    notify: Exec[systemctl-daemon-reload]

files:
  /etc/zlogout:
    ensure: absent
  /etc/puppetlabs/facter:
    ensure: directory
    mode: '0755'
    owner: root
    group: root
  /etc/puppetlabs/facter/facter.conf:
    ensure: file
    mode: '0644'
    owner: root
    group: root
    content: |
      facts : {
          blocklist : [ "EC2" ],
      }

sysctls:
  net.core.default_qdisc:
    ensure: present
    value: fq_codel
    target: /etc/sysctl.d/97-net-sysctl.conf
  net.ipv4.tcp_ecn:
    ensure: present
    value: 1
    target: /etc/sysctl.d/97-net-sysctl.conf
  net.ipv4.tcp_mtu_probing:
    ensure: present
    value: 2
    target: /etc/sysctl.d/97-net-sysctl.conf

ssh::client_options:
  Host *:
    ForwardAgent: yes
    ForwardX11: yes
    HashKnownHosts: no
    SendEnv: LANG LC_*
    VerifyHostKeyDNS: yes
    VisualHostKey: yes

ssh::server_options:
  AllowUsers: kenyon root
  PermitRootLogin: without-password

# Additional entries for /etc/ssh/ssh_known_hosts for hosts not
# managed by puppet. Puppet-managed hosts are automatically added by
# the ssh module.
sshkeys:
  einstein_rsa:
    type: rsa
    key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDGsvrpsky8KORBCApL6t/bcwOeWgtwlq9r4KT7DngxtFo/+b3h/Z7XCbrF5QWh0dQNqv/IBBzBorgfNj5YUz95fnmuRdDgK4zWjKioSrdlWlP2E5lDiKSceb0EL8k9za2QbTifrdya9oyMRuBWNij6JwD/FfOTYIP1Zre9PbLYCc0E13XhWDWoPNND/Rc+oi3qiRhOqKZTY/BK/GIz6vS5hP9p5aePgx4JpoUMndT2m8HpCqJJBJk5Xl2X+ekaKNG0jNwGHXumzAqHml0rmVTONHCiufDIp/a78dKdJRtsPxs42R84tCLzbDegzVbvdkA7GfKCBfuQrO1pnVpeilHZ
    host_aliases:
      - einstein
      - einstein.kenyonralph.com
  einstein_ecdsa:
    type: ecdsa-sha2-nistp256
    key: AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBJCq/itOjURSkwD0N551LFNJzd9a8grgi/W0aNF3abngiBUm/+QOgy0TDsG3LUZsO8doTWvmxB2rSDvPIuTjBa8=
    host_aliases:
      - einstein
      - einstein.kenyonralph.com
  einstein_ed25519:
    type: ed25519
    key: AAAAC3NzaC1lZDI1NTE5AAAAIO6JhMp1iWslik8qiRmdiAVUlgjZN8IyG5iokL5lFKYp
    host_aliases:
      - einstein
      - einstein.kenyonralph.com

# Local Variables:
# coding: utf-8
# End:
...
