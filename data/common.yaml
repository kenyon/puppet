---
# Common data.

classes:
  - network
  - systemd
  - timezone
  - sudo
  - ssh
  - mysite::ntp
  - accounts
  - rsyslog::config

lookup_options:
  accounts::user_list:
    merge: deep
  accounts::group_list:
    merge: deep
  apt::sources:
    merge: hash
  rhsm::enabled_repo_ids:
    merge: unique

timezone::timezone: America/Los_Angeles

# Packages I want installed.
packages:
  - aspell
  - colordiff
  - curl
  - emacs-nox
  - etckeeper
  - htop
  - info
  - keychain
  - lsof
  - mlocate
  - multitail
  - mutt
  - ndisc6
  - nmap # nmap includes ncat, its version of netcat (nc)
  - psmisc
  - pwgen
  - rsync
  - sntp
  - subnetcalc
  - time
  - tmux
  - tree
  - unzip
  - w3m
  - wdiff
  - wget
  - whois
  - zsh

# Packages I want to be absent.
# Can't really remove multiple packages though, even if I have listed
# all of their dependencies, because it tries to remove each package
# individually:
# https://tickets.puppetlabs.com/browse/PUP-146
# https://tickets.puppetlabs.com/browse/PUP-1061
packages_absent:
  - nano

services:
  ctrl-alt-del.target:
    ensure: stopped
    enable: mask

accounts::user_list:
  kenyon:
    ignore_password_if_empty: true
    password: ''
    comment: Kenyon Ralph
    shell: /bin/zsh
    groups:
      - sudo
      - adm
    managevim: false
    sshkeys:
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKcX1L+30WOCRpdhUAUBB7MedN2hteApi8E7RUVOPxsO kenyon@einstein
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAII4dqbnK4NXF72lVF7wScUpGhtCfdidW6RtvXikTdBiP ed25519-key-20200720

sudo::configs:
  insults:
    content: Defaults insults
  kenyon:
    content: 'kenyon ALL = (ALL:ALL) NOPASSWD: ALL'
  lessenv:
    content: Defaults env_keep += "LESS_TERMCAP_us LESS_TERMCAP_ue LESS_TERMCAP_so LESS_TERMCAP_se LESS_TERMCAP_me LESS_TERMCAP_md LESS_TERMCAP_mb"
  lessenv2:
    content: Defaults env_keep += "PAGER LESS MANWIDTH LESSOPEN BLOCKSIZE"

augeases:
  puppet.conf:
    context: /files/etc/puppetlabs/puppet/puppet.conf
    changes:
      - set main/show_diff true
      - set main/server puppet.kenyonralph.com
      # https://puppet.com/docs/puppet/latest/report.html
      - set master/reports log

docker::ipv6: true
docker::ip_masq: false
docker::iptables: false
docker::log_driver: journald

ini_settings:
  disable_systemd_CtrlAltDelBurstAction:
    path: /etc/systemd/system.conf
    section: Manager
    setting: CtrlAltDelBurstAction
    value: none

files:
  /etc/zlogout:
    ensure: absent
  /etc/puppetlabs/facter:
    ensure: directory
    mode: '0755'
    owner: root
    group: root
  /etc/puppetlabs/facter/facter.conf:
    ensure: file
    mode: '0644'
    owner: root
    group: root
    content: |
      facts : {
          blocklist : [ "EC2" ],
      }
  /home/kenyon/bin:
    ensure: directory
    owner: kenyon
    require: User[kenyon]
  /home/kenyon/.puppet-managed:
    ensure: directory
    owner: kenyon
    group: kenyon
    require: User[kenyon]
  /home/kenyon/.config:
    ensure: directory
    mode: '0700'
    owner: kenyon
    require: User[kenyon]
  /home/kenyon/.config/git:
    ensure: directory
    owner: kenyon
    require: User[kenyon]

kenyon_dotfiles:
  - .aspell.en.prepl
  - .aspell.en.pws
  - .bash_aliases
  - .bash_profile
  - .bashrc
  - .config/git/ignore
  - .devscripts
  - .dput.cf
  - .emacs.d
  - .gitconfig
  - .inputrc
  - .profile
  - .quiltrc
  - .screenrc
  - .signature
  - .tmux.conf
  - .toprc
  - .vim
  - .vimrc
  - .Xresources
  - .zlogin
  - .zshenv
  - .zshrc

rsyslog::config::actions:
  forward_all:
    type: omrelp
    config:
      target: syslog.kenyonralph.com
      port: 20514

rsyslog::config::modules:
  imfile: {}
  imklog: {}
  immark: {}
  imuxsock: {}
  omrelp: {}

rsyslog::feature_packages:
  - rsyslog-relp

sysctls:
  fs.inotify.max_user_watches:
    value: 524288
  net.core.default_qdisc:
    value: fq_codel
    target: /etc/sysctl.d/97-net-sysctl.conf
  net.ipv4.tcp_ecn:
    value: 1
    target: /etc/sysctl.d/97-net-sysctl.conf
  net.ipv4.tcp_mtu_probing:
    value: 2
    target: /etc/sysctl.d/97-net-sysctl.conf

systemd_dropin_files:
  noclear.conf:
    unit: getty@.service
    content: |
      [Service]
      TTYVTDisallocate=no

ssh::client_options:
  Host *:
    ForwardAgent: yes
    ForwardX11: yes
    HashKnownHosts: no
    SendEnv: LANG LC_*
    VerifyHostKeyDNS: yes
    VisualHostKey: yes

ssh::server_options:
  AllowUsers: kenyon root
  PasswordAuthentication: no
  PermitRootLogin: without-password

# Additional entries for /etc/ssh/ssh_known_hosts for hosts not
# managed by puppet. Puppet-managed hosts are automatically added by
# the ssh module.
sshkeys:
  galileo_rsa:
    type: rsa
    key: AAAAB3NzaC1yc2EAAAADAQABAAABAQCxD4iEPoeNC+6/nIKa4NAMPbEhCJZJNJRx1wmGCTQa85SthIgXAAAiwrXrBKbjEkzb0AJGbQbtIQY+lln9acDmEtZdsHShklIFeLa3QCoDHaVS7rmc9UgtKQx3bqlwPGveOfDfaFsU5gEfDI1ZqAyCpKnHBuE6S5WkmGobhtnnjJMeVEiNdjJtq4/2S1KyQRUvvMpPqyckgxziXqYGmUNFLb7j6Z0YdaaY0qL74+SqxGCkVMCYjy5JEIZdv9UhyXnbSI2cVqOU7zypk/A69WeyiEwQvXUn5xK8usjA9jFsDi0ULinmmfP+Ux7g8woS3S+7vLU5N9ynR82YjHD0rEPB
    host_aliases: &galileo_aliases
      - galileo
      - galileo.kenyonralph.com
  galileo_ecdsa:
    type: ecdsa-sha2-nistp256
    key: AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBkGpSbI1sgGVz+tnptE7V0xfdh5SUebQAkmf+OBcXqyDQwWZSIHILWB3XevmmwWChFgI+vjuCbUceos96Qgsn4=
    host_aliases: *galileo_aliases
  galileo_ed25519:
    type: ed25519
    host_aliases: *galileo_aliases
    key: AAAAC3NzaC1lZDI1NTE5AAAAICjhXAwk7deRXugeQENQSzcI97DAdUAwqBo5115YyLqd

  github.com:
    type: rsa
    key: AAAAB3NzaC1yc2EAAAABIwAAAQEAq2A7hRGmdnm9tUDbO9IDSwBK6TbQa+PXYPCPy6rbTrTtw7PHkccKrpp0yVhp5HdEIcKr6pLlVDBfOLX9QUsyCOV0wzfjIJNlGEYsdlLJizHhbn2mUjvSAHQqZETYP81eFzLQNnPHt4EVVUh7VfDESU84KezmD5QlWpXLmvU31/yMf+Se8xhHTvKSCZIFImWwoG6mbUoWf9nzpIoaSjB+weqqUUmpaaasXVal72J+UX2B+2RPW3RcT0eOzQgqlJL3RKrTJvdsjE3JEAvGq3lGHSZXy28G3skua2SmVi/w4yCE6gbODqnTWlg7+wC604ydGXA8VJiS5ap43JXiUFFAaQ==

  gitlab.com_rsa:
    type: rsa
    host_aliases: gitlab.com
    key: AAAAB3NzaC1yc2EAAAADAQABAAABAQCsj2bNKTBSpIYDEGk9KxsGh3mySTRgMtXL583qmBpzeQ+jqCMRgBqB98u3z++J1sKlXHWfM9dyhSevkMwSbhoR8XIq/U0tCNyokEi/ueaBMCvbcTHhO7FcwzY92WK4Yt0aGROY5qX2UKSeOvuP4D6TPqKF1onrSzH9bx9XUf2lEdWT/ia1NEKjunUqu1xOB/StKDHMoX4/OKyIzuS0q/T1zOATthvasJFoPrAjkohTyaDUz2LN5JoH839hViyEG82yB+MjcFV5MU3N1l1QL3cVUCh93xSaua1N85qivl+siMkPGbO5xR/En4iEY6K2XPASUEMaieWVNTRCtJ4S8H+9
  gitlab.com_ecdsa:
    type: ecdsa-sha2-nistp256
    host_aliases: gitlab.com
    key: AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFSMqzJeV9rUzU4kWitGjeR4PWSa29SPqJ1fVkhtj3Hw9xjLVXVYrU9QlYWrOLXBpQ6KWjbjTDTdDkoohFzgbEY=
  gitlab.com_ed25519:
    type: ed25519
    host_aliases: gitlab.com
    key: AAAAC3NzaC1lZDI1NTE5AAAAIAfuCHKVTjquxvt6CM6tdG4SLp1Btn/nOeHHE5UOzRdf

  lish_fremont_rsa:
    type: rsa
    host_aliases: lish-fremont.linode.com
    key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDb9siUm3yq4fVBYPtLh3Dg6VofNkgbRb9GaL+8q4uRRcQCOqVjGdB1ur6qZCQxknDKPwNvMuEYbWia/3svvbjCESkZAc8+DjLwe1gNE9fZ+x+KNOZTKmrQRh2+anYVi9oaHFwY/oNnfr9KeEKtRHd1lHTExO2mdyeAS1Ly+A5P6sjWyTLcOHQWGYEXxzwbsyjrmgjIHnmqRpKxlrBsdUokLKcFQvzuB3xiH2fvdXPlBJQcUb7g9tuITWzsjz6lozVPSQuvOJHthDZVIEfkT49F+Cpe9xviIAd/XqZG6xtosK/4Eu4Hof13jlT1uli9ZXnn0ROS6wKGsmLl3YWBG6DL
  lish_fremont_ecdsa:
    type: ecdsa-sha2-nistp256
    key: AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEptV+WZ7MZXFnIEV9GXDEstViqlLKTSw9QY9qNE4CERwO537KAlYAaDoPut5YT4TpCZgqP32B1ECHc3LSD987o=
    host_aliases: lish-fremont.linode.com
  lish_fremont_ed25519:
    type: ed25519
    host_aliases: lish-fremont.linode.com
    key: AAAAC3NzaC1lZDI1NTE5AAAAIHAIXJ8SyXG2St6DgT6gQmkQSsX3pyp5FcQoSy/R2x9i

  turing_rsa:
    type: rsa
    host_aliases: &turing_aliases
      - turing
      - turing.kenyonralph.com
      - 10.0.0.1
    key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDTgU2aUT/K2l1fOHScGz3f1llY1Whzt4DzmubwonyypxBS6PdXMaMs7rJ7hqwil50bN5IfluI766IFZfzz++Os4jGTDh7Ri4lr1pqiM2alieJfddLpH9JEgDfXGx7xTLV4+iKKagzDIdf/WHGwmfuK2j9pDBUuzz3igDkcJOOC91RgcUn/+v06c/21aS3n68psozTO2JkEwYlcQDozwW/eE3vwNNWdtMzd4Lyfvh6amWus6vt/hOh1TS5SM37NBRYS5jpcm39ZMhzc/+HPUt3uU0ht7FJFO0n8Dn0+QaeCR+c4y7jbGKXuGRgNPDNjGoV8Q+N0sw95ObZV2Qqeuood
  turing_ecdsa:
    type: ecdsa-sha2-nistp256
    host_aliases: *turing_aliases
    key: AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAr4mZeYB3lqS3Xw9V8Lp+PNhELJLqUNb8M6+D++Qm8WUD+zxwuc2pgnjimr5wVSv5iS/w96O4PUFAaRcWBJTzI=
  turing_ed25519:
    type: ed25519
    host_aliases: *turing_aliases
    key: AAAAC3NzaC1lZDI1NTE5AAAAIIHgJAOsIt2Q50bojzd/B3OlV3LIkg3C+fp/WeEwJqLX

vcsrepos:
  /home/kenyon/.puppet-managed/dotfiles:
    ensure: latest
    provider: git
    require:
      - User[kenyon]
      - File[/home/kenyon/.puppet-managed]
    source: https://gitlab.com/kenyon/dotfiles.git
    user: kenyon
  /home/kenyon/.puppet-managed/scripts:
    ensure: latest
    provider: git
    require:
      - User[kenyon]
      - File[/home/kenyon/.puppet-managed]
    source: https://gitlab.com/kenyon/scripts.git
    user: kenyon

# Local Variables:
# coding: utf-8
# End:
...
